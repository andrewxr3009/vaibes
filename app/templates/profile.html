<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil - Vaibes</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        .profile-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .profile-header {
            display: flex;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 20px;
                }
        .post-header {
            display: flex;                  /* Ativa o flexbox para alinhamento */
            align-items: center;           /* Alinha verticalmente no centro */
            justify-content: space-between; /* Espaça a foto, nome e botão de seguir */
            margin-bottom: 10px;           /* Espaçamento inferior */
        }
        
        .post-info-left {
            display: flex;                 /* Alinha a imagem e o nome do usuário horizontalmente */
            align-items: center;           /* Centraliza a imagem e o nome verticalmente */
        }
        
        .p-profile-pic {
            width: 40px;                   /* Tamanho reduzido da imagem de perfil */
            height: 40px;                  /* Mantém a proporção da imagem */
            border-radius: 50%;            /* Deixa a imagem circular */
            margin-right: 10px;            /* Espaço entre a imagem e o nome */
        }
        
        .follow-button {
            background-color: #022247;     /* Cor do botão de seguir */
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .follow-button.following {
            background-color: #d9534f;     /* Cor do botão quando o usuário está seguindo */
        }
        
                .profile-pic {
            border-radius: 50%;
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin-right: 20px;
            border: 2px solid #022247;
        }
        .profile-info {
            flex: 1;
        }
        .followers-count {
            margin-top: 10px;
            font-size: 16px;
            color: #555;
        }
        .edit-button {
            background-color: #022247;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            float: right;
        }
        .edit-button:hover {
            background-color: #0056b3;
        }
        .posts-container {
            margin-top: 20px;
        }
        .post {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            padding: 15px;
        }

        .post-info a {
            text-decoration: none;
            color: #022247;
            font-weight: bold;
            font-size: 16px;
        }
        .follow-button {
            background-color: #022247;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 20px;
            cursor: pointer;
        }
        .follow-button.following {
            background-color: transparent;
            color: #022247;
            border: 1px solid #022247;
        }
        .post-info-right {
            color: #777;
            font-size: 12px;
        }
        .post-body {
            margin-top: 15px;
            cursor: pointer;
            color: #333;
        }
        .post-body a {
            color: #0056b3;
            text-decoration: none;
        }
        .post-body a:hover {
            text-decoration: underline;
        }
        .gif-container {
        display: flex;
        flex-wrap: wrap;                /* Os GIFs ficam em várias linhas, se necessário */
        gap: 10px;                      /* Espaço entre os GIFs */
        margin-top: 10px;
    }

    .gif-item {
        width: 250px;                   /* Largura padrão para os GIFs */
        height: auto;                   /* Altura proporcional */
        border-radius: 10px;            /* Bordas arredondadas nos GIFs */
        cursor: pointer;                /* Muda o cursor ao passar sobre o GIF */
        transition: transform 0.2s ease; /* Transição suave de efeito */
    }
    .photo-item {
        width: 250px;                   /* Largura padrão para os GIFs */
        height: auto;                   /* Altura proporcional */
        border-radius: 10px;            /* Bordas arredondadas nos GIFs */
        cursor: pointer;                /* Muda o cursor ao passar sobre o GIF */
        transition: transform 0.2s ease; /* Transição suave de efeito */
    }

    .gif-item:hover {
        transform: scale(1.1);          /* Aumenta o GIF ao passar o mouse */
    }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .like-button, .share-button {
            background-color: #022247;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
        }
        .like-button:hover, .share-button:hover {
            background-color: #0056b3;
        }
        .post-options {
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        .post-options-menu {
            display: none;
            position: absolute;
            right: 10px;
            top: 30px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            z-index: 100;
            padding: 10px;
        }
        .post-options-menu.active {
            display: block;
        }
        .post-options-menu button {
            background-color: transparent;
            border: none;
            width: 100%;
            text-align: left;
            padding: 10px 0;
            cursor: pointer;
            color: #333;
        }
        .post-options-menu button:hover {
            background-color: #f0f0f0;
        }
        /* Estilo para a barra inferior */
        .bottom-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: #fff;
            padding: 10px 0;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1000;
        }
        .bottom-bar a, .create-post-button {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #494948;
        }
        .bottom-bar img {
            margin-bottom: 4px;
            width: 28px;
            height: 28px;
        }
        .bottom-bar span {
            font-size: 12px;
        }
        .create-post-button {
            position: relative;
            top: -10px;
            z-index: 100;
        }
        .create-post-button img {
            width: 40px;
            height: 40px;
            transition: transform 0.3s ease;
        }
        .create-post-button:hover img {
            transform: scale(1.1);
        }
        /* Modal de criação de post */
        .bottom-bar-modal {
            display: none; /* Começa oculto */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .bottom-bar-modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
        }
        textarea {
        width: 100%;                    /* O textarea ocupa 100% da largura do formulário */
        padding: 15px;                  /* Espaçamento interno */
        border: 1px solid #ddd;         /* Borda cinza clara */
        border-radius: 30px;            /* Bordas arredondadas */
        font-size: 16px;                /* Tamanho da fonte */
        outline: none;                  /* Remove o contorno ao focar */
        box-sizing: border-box;         /* Garante que o padding não aumente o tamanho total */
        margin-bottom: 10px;            /* Espaçamento inferior */
        resize: none;                   /* Remove a opção de redimensionar o textarea */
        height: 150px;                  /* Define uma altura padrão */
    }

    /* Estiliza o botão de envio */
    button[type="submit"] {
        width: 100%;                    /* O botão ocupa 100% da largura do formulário */
        padding: 15px;                  /* Espaçamento interno */
        background-color: #022247;      /* Cor de fundo azul */
        color: white;                   /* Cor do texto */
        border: none;                   /* Remove a borda padrão */
        border-radius: 30px;            /* Bordas arredondadas */
        font-size: 16px;                /* Tamanho da fonte */
        cursor: pointer;                /* Muda o cursor ao passar o mouse */
        transition: background-color 0.3s ease; /* Transição suave da cor de fundo */
    }

    button[type="submit"]:hover {
        background-color: #0056b3;      /* Cor de fundo ao passar o mouse */
    }

    /* Estiliza o campo de busca de GIF */
    input[type="text"] {
        width: 100%;                    /* O campo de texto ocupa 100% da largura */
        padding: 15px;                  /* Espaçamento interno */
        border: 1px solid #ddd;         /* Borda cinza clara */
        border-radius: 30px;            /* Bordas arredondadas */
        font-size: 16px;                /* Tamanho da fonte */
        outline: none;                  /* Remove o contorno ao focar */
        box-sizing: border-box;         /* Garante que o padding não aumente o tamanho total */
        margin-bottom: 10px;            /* Espaçamento inferior */
    }

    /* Estiliza o container de GIFs */
    .gif-container {
        display: flex;
        flex-wrap: wrap;                /* Os GIFs ficam em várias linhas, se necessário */
        gap: 10px;                      /* Espaço entre os GIFs */
        margin-top: 10px;
    }
    .bottom-bar-modal {
        display: none; /* O modal começa oculto */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7); /* Fundo escuro com transparência */
        justify-content: center;
        align-items: center;
        z-index: 1000; /* Coloca o modal acima de outros elementos */
    }

    .bottom-bar-modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        width: 90%;
        max-width: 500px;
    }
    /* Estilização dos botões no modal */
    .modal-button {
        background-color: #022247; /* Cor do botão */
        color: white; /* Texto branco */
        border: none; /* Sem borda */
        padding: 10px 20px; /* Padding interno */
        border-radius: 25px; /* Bordas arredondadas */
        cursor: pointer; /* Cursor em forma de mão */
        transition: background-color 0.3s, transform 0.3s; /* Transição suave */
        margin: 5px; /* Margem entre botões */
    }
    
    .modal-button:hover {
        background-color: #0056b3; /* Cor ao passar o mouse */
        transform: scale(1.05); /* Leve aumento ao passar o mouse */
    }
    
    .modal-button:active {
        transform: scale(0.95); /* Efeito de pressão no botão */
    }
    .bottom-bar-link {
        display: flex;                 /* Usando flexbox para alinhar verticalmente */
        flex-direction: column;        /* Coloca os elementos em coluna (imagem em cima, texto embaixo) */
        align-items: center;           /* Centraliza os itens horizontalmente */
        text-decoration: none;         /* Remove o sublinhado */
        color: black;                  /* Cor do texto, troque por uma cor desejada */
    }
    .bottom-bar-modal.active {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7); /* Fundo escuro com transparência */
        justify-content: center;
        align-items: center;
        z-index: 1000; /* Coloca o modal acima de outros elementos */
    }

    </style>
</head>
<body>
    <div class="profile-container">
        <div class="profile-header">
            {% if profile.profile_picture %}
                <img src="{{ profile.profile_picture }}" alt="Foto de perfil" class="profile-pic">
            {% else %}
                <img src="{{ url_for('static', filename='default-profile-pic.png') }}" alt="Foto de perfil" class="profile-pic">
            {% endif %}
            
            <div class="profile-info">
                <h1>{{ profile.username }}</h1>
                {% if user.bio %}
                    <p class="bio">{{ profile.bio }}</p>
                {% endif %}
                <div class="followers-count">
                    {{ follower_count }} seguidores
                </div>
                
       
        </div>
        

        <div id="posts-container" class="posts-container">
            {% for post in posts %}
            <div class="post" id="post-{{ post.id }}">
                <div class="post-header">
                    <div class="user.ppost-info-left">
                        <img src="{{ post.user.profile_picture or url_for('static', filename='uploads/default-profile-pic.png') }}" alt="Foto de perfil" class="p-profile-pic">
                        <div class="post-info">
                                <strong>{{ post.user.username }}</strong>
                            
                                <form id="follow-form-{{ post['user']['id'] }}" action="{{ url_for('users.toggle_follow', username=post['user']['username']) }}" method="POST" class="follow-form">
                                    {% if user.is_following(post['user']['id']) %}
                                        <button type="submit" class="follow-button following">Deixar de Seguir</button>
                                    {% else %}
                                        <button type="submit" class="follow-button">Seguir</button>
                                    {% endif %}
                                </form>
                        </div>
                    </div>

                    <div class="post-info-right">
                        <span class="post-date">{{ post.timestamp.strftime('%d de %B de %Y') }}</span>
                    </div>
                </div>

                <div class="post-body" onclick="redirectToPost({{ post.id }})">
                    {% set content = post.content %}
                    {% for word in content.split() %}
                        {% if word.startswith('#') %}
                            <a href="/hashtag/{{ word[1:] }}">{{ word }}</a>
                        {% else %}
                            {{ word }}
                        {% endif %}
                    {% endfor %}
                    {% if post.gif_url %}
                        <div class="gif-container">
                            <img src="{{ post.gif_url }}" alt="GIF" class="gif-item">
                        </div>
                    {% endif %}
                    {% if post.img_url %}
                    <div class="photo-container">
                        <img src="{{ post.img_url }}" alt="Foto" class="photo-item">
                    </div>
                {% endif %}
                </div>

                <div class="post-footer">
                    <div class="like-container">
                        <button class="like-button" id="like-button-{{ post.id }}" onclick="likePost({{ post.id }})">
                            Curtir <span id="like-count-{{ post.id }}">{{ post.likes|length }}</span>
                        </button>
                    </div>
                    <div class="share-container">
                        <button class="share-button" id="share-button-{{ post.id }}" onclick="sharePost({{ post.id }})">
                            Compartilhar
                        </button>
                    </div>
                    <div class="post-options" onclick="toggleOptions({{ post.id }})">•••</div>
                </div>

                <div class="post-options-menu" id="options-menu-{{ post.id }}">
                    {% if user.id == post.user.id %}
                        <button onclick="deletePost({{ post.id }})">Excluir</button>
                        <button onclick="viewInsights({{ post.id }})">Ver Insights</button>
                    {% else %}
                        <button>Denunciar</button>
                        <button>Silenciar</button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="bottom-bar">
        <a href="{{ url_for('main.home') }}" class="bottom-bar-link">
            <img src="{{ url_for('static', filename='home-icon.png') }}" alt="Home">
            <span>Home</span>
        </a>
        <a href="{{ url_for('main.search') }}" class="bottom-bar-link">
            <img src="{{ url_for('static', filename='search-icon.png') }}" alt="Buscar">
            <span>Buscar</span>
        </a>
        <div class="create-post-button" onclick="openPostModal()">
            <img src="{{ url_for('static', filename='post-icon.png') }}" alt="Criar">
            <span>Criar</span>
        </div>
        <a href="{{ url_for('notifications.notifications') }}" class="bottom-bar-link">
            <img src="{{ url_for('static', filename='notifications-icon.png') }}" alt="Notificações">
            <span>Notificações</span>
        </a>
        <a href="{{ url_for('users.profile', username=user.username) }}" class="bottom-bar-link">
            <img src="{{ user.profile_picture or url_for('static', filename='uploads/default-profile-pic.png') }}" alt="Foto de perfil" class="profile-pic">
            <span>Perfil</span>
        </a>
    </div>

    <!-- Modal de criação de post atualizado -->
    <div id="bottom-bar-modal" class="bottom-bar-modal">
        <div class="bottom-bar-modal-content">
            <div class="modal-header">
                <h3>Criar post</h3>
                <button class="modal-close" onclick="closePostModal()">×</button>
            </div>
            
            <!-- Formulário para criação do post -->
            <form id="postForm" method="POST" enctype="multipart/form-data">
                <textarea name="content" class="post-textarea" placeholder="O que você está pensando?"></textarea>
                
                <!-- Exemplo: input para imagem (opcional) -->
                <div class="post-actions">
                    <label class="action-button">
                        <img src="{{ url_for('static', filename='image-icon.png') }}" alt="Imagem" width="20">
                        Foto
                        <input type="file" name="image" accept="image/*" style="display: none;">
                    </label>
                    <!-- Se desejar incluir GIF, adicione um input similar -->
                    <!-- <button class="action-button">
                        <img src="{{ url_for('static', filename='gif-icon.png') }}" alt="GIF" width="20">
                        GIF
                    </button> -->
                </div>
                
                <button type="submit" class="post-submit">Publicar</button>
            </form>
        </div>
    </div>

    <script>
        function toggleOptions(postId) {
            document.getElementById(`options-menu-${postId}`).classList.toggle('active');
        }

        function deletePost(postId) {
            if (confirm('Tem certeza que deseja excluir este post?')) {
                fetch(`/delete_post/${postId}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById(`post-${postId}`).remove();
                            alert('Post excluído com sucesso!');
                        } else {
                            alert('Erro ao excluir o post.');
                        }
                    });
            }
        }

        function viewInsights(postId) {
            window.location.href = `/insights/${postId}`;
        }

        function openModal() {
            document.getElementById('bottom-bar-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('bottom-bar-modal').classList.remove('active');
            document.getElementById('gif-url').value = '';
            document.getElementById('hashtag-input').value = '';
        }

        document.getElementById('postForm').addEventListener('submit', function(event) {
            const content = document.querySelector('textarea[name="content"]').value;
            const hashtags = content.match(/#\w+/g) || [];
            document.getElementById('hashtag-input').value = hashtags.join(',');
        });
    </script>
</body>
</html>
